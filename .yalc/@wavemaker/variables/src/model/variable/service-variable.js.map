{"version":3,"file":"service-variable.js","sourceRoot":"./","sources":["src/model/variable/service-variable.ts"],"names":[],"mappings":"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","sourcesContent":["import { isDefined } from \"../../util/utils\";\nimport { DataSource, IDataSource } from \"../../types/types\";\n\nimport { VariableManagerFactory } from '../../factory/variable-manager.factory';\nimport { ApiAwareVariable } from './api-aware-variable';\nimport { VARIABLE_CONSTANTS } from '../../constants/variables.constants';\nimport { ServiceVariableManager } from '../../manager/variable/service-variable.manager';\nimport { ServiceVariableUtils } from '../../util/variable/service-variable.utils';\nimport {HttpClientService} from \"../../types/http-client.service\";\n\ndeclare const _: any;\n\nconst getManager = (): ServiceVariableManager => {\n    return VariableManagerFactory.get(VARIABLE_CONSTANTS.CATEGORY.SERVICE);\n};\n\n\nexport interface SVConfig {\n    name: string,\n    dataSet: any,\n    isList: boolean,\n    service: string,\n    operation: string,\n    operationId: string,\n    dataBinding: any;\n    serviceInfo?: any,\n    httpClientService: HttpClientService\n}\n\nexport class ServiceVariable extends ApiAwareVariable implements IDataSource {\n\n    // Used to track progress of file upload\n    _progressObservable;\n    // Used to track a variable http call, so that it can be cancelled at any point of time during its execution\n    _observable;\n    pagination;\n    simulateFileDownload;\n    serviceInfo;\n    httpService;\n\n    constructor(variable: SVConfig) {\n        super();\n        Object.assign(this as any, variable);\n        this.serviceInfo = variable.serviceInfo;\n        this.httpService = variable.httpClientService;\n    }\n\n    execute(operation, options) {\n        let returnVal = super.execute(operation, options);\n        if (isDefined(returnVal)) {\n            return returnVal;\n        }\n\n        switch (operation) {\n            case DataSource.Operation.IS_API_AWARE:\n                returnVal = true;\n                break;\n            case DataSource.Operation.SUPPORTS_CRUD:\n                returnVal = false;\n                break;\n            case DataSource.Operation.SUPPORTS_DISTINCT_API:\n                returnVal = false;\n                break;\n            case DataSource.Operation.IS_PAGEABLE:\n                // Check for both client and server side pagination existence\n                returnVal = this.hasPagination();\n                break;\n            case DataSource.Operation.IS_SORTABLE:\n                returnVal = this.hasPagination() && !(this as any)._paginationConfig;\n                break;\n            case DataSource.Operation.SUPPORTS_SERVER_FILTER:\n                returnVal = false;\n                break;\n            case DataSource.Operation.SET_INPUT:\n                returnVal = this.setInput(options);\n                break;\n            case DataSource.Operation.LIST_RECORDS:\n                returnVal = this.invoke(options);\n                break;\n            case DataSource.Operation.INVOKE :\n                returnVal = this.invoke(options);\n                break;\n            case DataSource.Operation.UPDATE :\n                returnVal = this.update(options);\n                break;\n            case DataSource.Operation.SEARCH_RECORDS:\n                returnVal = this.searchRecords(options);\n                break;\n            case DataSource.Operation.DOWNLOAD:\n                returnVal = this.download(options);\n                break;\n            case DataSource.Operation.GET_PAGING_OPTIONS:\n                returnVal = this.pagination;\n                break;\n            case DataSource.Operation.IS_UPDATE_REQUIRED:\n                returnVal = this.isUpdateRequired(options);\n                break;\n            case DataSource.Operation.IS_BOUND_TO_LOCALE:\n                returnVal = false;\n                break;\n            case DataSource.Operation.CANCEL:\n                returnVal = this.cancel(options);\n                break;\n            case DataSource.Operation.SET_PAGINATION:\n                returnVal = this.setPagination(options);\n                break;\n            default :\n                returnVal = {};\n                break;\n        }\n        return returnVal;\n    }\n\n    hasPagination() {\n        return this.controller === VARIABLE_CONSTANTS.CONTROLLER_TYPE.QUERY || !_.isEmpty(this.pagination);\n    }\n\n    invoke(options?, success?, error?) {\n        // return this.invokeVar();\n        return getManager().invoke(this, options, success, error);\n    }\n\n    update(options, success?, error?) {\n        return getManager().invoke(this, options, success, error);\n    }\n\n    download(options, success?, error?) {\n        return getManager().download(this, options, success, error);\n    }\n\n    setInput(key, val?, options?) {\n        return getManager().setInput(this, key, val, options);\n    }\n\n    searchRecords(options, success?, error?) {\n        return new Promise((resolve, reject) => {\n            getManager().searchRecords(this, options, (response, pagination) => {\n                resolve({data: response.content || response, pagination});\n            }, reject);\n        });\n    }\n\n    isUpdateRequired(hasData) {\n        const inputFields = getManager().getInputParms(this);\n        const queryParams = ServiceVariableUtils.excludePaginationParams(inputFields);\n\n        if (!queryParams.length) {\n            // if we don't have any query params and variable data is available then we don't need variable update, so return false\n            if (hasData) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    setPagination(data) {\n        return getManager().setPagination(this, data);\n    }\n\n    cancel(options?) {\n        return getManager().cancel(this, options);\n    }\n\n    init() {\n        getManager().initBinding(this);\n        getManager().defineFirstLastRecord(this);\n    }\n}\n"]}
<link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    rel="stylesheet"
/>

<style>
    .wm-token-tab-content {
        padding: 16px;
    }

    .wm-token-tab-content .content-wrapper {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 8px 0;
    }

    .input-wrapper {
        display: flex;
        border: 1px solid var(--icon-color);
        align-items: center;
        padding: 2px 6px;
        border-radius: 4px;
        transition: border-color 0.3s ease;
    }

    .input-wrapper input {
        height: 28px;
        border: none;
        border-radius: 4px;
        padding: 0 8px;
        font-size: 14px;
    }

    .input-wrapper input.color-picker {
        border-radius: 50%;
        width: 28px;
        height: 28px;
        padding: 0;
        background-color: transparent;
        cursor: pointer;
    }

    .input-wrapper input:hover {
        border-color: #0056b3;
    }

    .color-picker:focus,
    .input-box:focus {
        outline: none;
        border-color: #007bff;
    }


    input[type="color"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        padding: 0;
        cursor: pointer;
        overflow: hidden;
    }

    input[type="color"]::-webkit-color-swatch {
        border-radius: 50%;
        border: none;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
        border: none;
    }

    div.css-s0f71y {
        background-color: #000;
    }
</style>

<script type="text/javascript" ;>
    const componentIcons = {
        button: "fa-solid fa-diagram-predecessor",
        anchor: "fa-solid fa-link",
        buttongroup: "fa-solid fa-layer-group",
        icon: "fa-solid fa-icons",
        search: "fa-solid fa-magnifying-glass",
        tooltip: "fa-solid fa-circle-info",
        video: "fa-solid fa-video",
        checkbox: "fa-solid fa-square-check",
        picture: "fa-solid fa-image",
        calendar: "fa-solid fa-calendar-days",
        currency: "fa-solid fa-dollar-sign",
        fileupload: "fa-solid fa-file-upload",
        radioset: "fa-solid fa-circle-dot",
        rating: "fa-solid fa-star",
        time: "fa-solid fa-clock",
        toggle: "fa-solid fa-toggle-on",
        spinner: "fa-solid fa-spinner",
        progressbar: "fa-solid fa-bars-progress",
        progresscircle: "fa-solid fa-circle-notch",
        label: "fa-solid fa-font",
        list: "fa-solid fa-list",
        text: "fa-solid fa-text-width",
        textarea: "fa-solid fa-align-left",
        table: "fa-solid fa-table",
        tab: "fa-solid fa-folder",
        card: "fa-solid fa-id-card",
        chart: "fa-solid fa-chart-pie",
        panel: "fa-solid fa-columns",
        breadcrumb: "fa-solid fa-ellipsis-h",
        accordion: "fa-solid fa-bars-staggered",
        carousel: "fa-solid fa-sliders-h",
        tree: "fa-solid fa-tree",
        map: "fa-solid fa-map",
        slider: "fa-solid fa-sliders",
    };

    document.addEventListener("DOMContentLoaded", () => {
        // Function to replace SVGs with FontAwesome icons
        const replaceSVGs = () => {
            const sidebarItems = document.querySelectorAll(
                '[data-nodetype="component"]:not(.icon-replaced)'
            );

            sidebarItems.forEach((sidebarItem) => {
                sidebarItem.classList.add("icon-replaced");
                const svgElement =
                    sidebarItem.querySelector("button > div > svg");
                if (svgElement) {
                    svgElement.remove();
                }

                const name = sidebarItem
                    .getAttribute("data-item-id")
                    ?.split("-")[1];
                const iconClass =
                    componentIcons[name] || "fa-solid fa-border-all";

                const newIcon = document.createElement("i");
                newIcon.className = `fas ${iconClass}`;
                newIcon.classList.add("css-1e3avu6");

                const target = sidebarItem.querySelector("button > div");
                if (target) {
                    target.prepend(newIcon);
                }
            });
        };

        // Function to handle auto-collapse logic
        const setupAutoCollapse = () => {
            const sidebarItems = document.querySelectorAll(
                '[data-nodetype="component"]:not(.listener-added)'
            );

            // Keep track of the currently open item
            let currentOpenItem = null;

            // Find initially open item
            sidebarItems.forEach((item) => {
                if (item.querySelector('button[aria-expanded="true"]')) {
                    currentOpenItem = item;
                }
            });

            sidebarItems.forEach((item) => {
                item.classList.add("listener-added");
                item.addEventListener("click", (event) => {
                    const button = item.querySelector("button");
                    const isExpanded =
                        button?.getAttribute("aria-expanded") === "true";
                    // If clicking the same item that's already open, let Storybook handle it
                    if (currentOpenItem === item) {
                        currentOpenItem = null;
                        return;
                    }

                    // Close the previously open item if it exists
                    if (currentOpenItem) {
                        const prevButton =
                            currentOpenItem.querySelector("button");
                        if (prevButton) {
                            prevButton.click();
                        }
                    }

                    if (!isExpanded) {
                        currentOpenItem = item;
                    }
                });
            });
        };

        // MutationObserver to monitor when the sidebar is added/updated
        const observer = new MutationObserver((mutationsList) => {
            for (const mutation of mutationsList) {
                if (mutation.type === "childList") {
                    const sidebar =
                        document.querySelector(".sidebar-container");
                    if (sidebar) {
                        replaceSVGs(); // Replace SVGs
                        setupAutoCollapse(); // Setup auto-collapse logic
                    }
                }
            }
        });

        // Start observing the DOM for sidebar injection
        observer.observe(document.body, { childList: true, subtree: true });
    });
</script>
